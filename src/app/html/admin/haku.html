<div data-ng-if="hakuState">

    <!-- TODO: move to directive -->
    <div class="px mb-l" data-ng-if="showEditDialog">

        <form name="personForm" novalidate>
          <span class="btn btn-default pull-right "
                data-ng-click="closeForm()"
                title="Sulje">Sulje
              <i class="fa fa-close fa-lg pl"></i>
          </span>

        <h4 data-ng-if="selectedPerson.id" class="font-weight-bold">Muokkaat henkilöä: {{selectedPerson.etunimi}} {{selectedPerson.sukunimi}}</h4>
        <h4 data-ng-if="!selectedPerson.id" class="font-weight-bold">Lisää uusi henkilö</h4>

        <div class="row form-group" id="firstnameGroup">
            <div class="col-xs-12 ">
                <label class="control-label">Etunimi</label>
                <i class="fa fa-asterisk required-star" aria-hidden="true"></i>
                <input type="text" class="form-control" name="firstname"
                       data-ng-model="selectedPerson.etunimi" required>
            </div>
        </div>
        <div class="row form-group"  id="lastnameGroup">
            <div class="col-xs-12">
                <label class="control-label">Sukunimi</label>
                <i class="fa fa-asterisk required-star" aria-hidden="true"></i>
                <input type="text" class="form-control" name="lastname"
                       data-ng-model="selectedPerson.sukunimi" required>
            </div>
        </div>
        <div class="row form-group" id="hrnumberGroup">
            <div class="col-xs-12">
                <label class="control-label">Tunniste / ID</label>
                <i class="fa fa-asterisk required-star" aria-hidden="true"></i>
                <input type="text" class="form-control" name="hrnumber"
                       data-ng-model="selectedPerson.hrnumero"
                       data-ng-disabled="selectedPerson.id"
                       required>
            </div>
        </div>
        <div class="row form-group">
            <div class="col-xs-12">
                <label class="control-label">Sähköposti</label>
                <input type="text" class="form-control" name="email"
                       data-ng-model="selectedPerson.email">
            </div>
        </div>
        <div class="row form-group" id="orcidGroup">
            <div class="col-xs-12"
                 value="selectedPerson.orcid">
                <label class="control-label">ORCID</label>
                <input type="text" class="form-control" name="orcid"
                       data-ng-model="selectedPerson.orcid"
                       orcid-directive>
            </div>
        </div>
        <div class="row form-group"
             data-ng-if="isFieldVisible('alayksikko')">
            <div data-ng-if="selectedPerson.alayksikko[0]" class="col-xs-12">
                <label class="control-label">Alayksikko (Maks. 3)</label>
                <div data-ng-repeat="a in selectedPerson.alayksikko track by $index" class="row mb-x">
                    <div class="col-xs-11">
                        <input disabled="true"
                               type="text" class="form-control"
                               data-ng-model="a" name="alayksikko"
                               >
                    </div>
                    <div class="col-xs-1">
                        <span class="btn btn-danger"
                              data-ng-click="removeAlayksikko($index)"
                              data-ng-hide="selectedPerson.alayksikko.length<2"
                              title="{{i18n.content.form.organisaatiotekija.poista.tooltip[lang]}}"
                              data-ng-bind="i18n.content.form.organisaatiotekija.poista[lang]">
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row form-group" data-ng-if="isFieldVisible('alayksikko')" id="alayksikkoGroup">
            <div class="col-xs-12">
                <label class="control-label">Lisää alayksiköitä</label>
                <i data-ng-if="isFieldRequired('alayksikko')" class="fa fa-asterisk required-star" aria-hidden="true"></i>
            </div>

            <div class="col-xs-12 col-sm-5">
                <ui-select data-ng-model="alayksikkovuosi.selected"
                           theme="bootstrap">
                    <ui-select-match class="ui-select-match"
                                     data-ng-value="alayksikkovuosi.selected"
                                     placeholder="{{i18n.content.form.organisaatiotekija.alayksikkovuosi.picktip[lang]}}">
                        {{ $select.selected.label }}
                    </ui-select-match>
                    <ui-select-choices repeat="ala in alayksikkovuodet">
                        {{ala.label}}
                    </ui-select-choices>
                </ui-select>
            </div>
            <div class="col-xs-12 col-sm-7">
                <ui-select data-ng-model="alayksikko.selected"
                           on-select="addAlayksikko($select.selected.arvo)"
                           theme="bootstrap"
                           class="dropdown-height-300">
                    <ui-select-match class="ui-select-match"
                                     placeholder="Lisää alayksikkö">Lisää alayksikkö

                    </ui-select-match>
                    <ui-select-choices repeat="o in getAlayksikkoData(alayksikkovuosi.selected) | filter: $select.search">
                        {{ o.arvo}} {{o.selite}}
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>

        <div class="row mt-xl">
            <div data-ng-class="{ 'col-xs-12': !selectedPerson.id, 'col-xs-8': selectedPerson.id }">
                <button class="btn btn-primary btn-block btn-lg" type="submit" data-ng-click="savePerson(personForm)">
                    Tallenna
                </button>
            </div>
            <div data-ng-if="selectedPerson.id" class="col-xs-4">
                <button class="btn btn-danger btn-block btn-lg" data-ng-click="removePerson()">
                    Poista käyttäjä
                </button>
            </div>
        </div>
        </form>
    </div>

    <div data-ng-hide="showEditDialog">
    <div data-ng-if="showList" style="margin: 30px 15px;">
        <span class="btn btn-default pull-right "
              data-ng-click="closeList()"
              title="Sulje">Sulje
              <i class="fa fa-close fa-lg pl"></i>
          </span>
        <person-publication-list-directive
                                           person="personToShow"
                                           publication-list="publicationList"
                                          >
        </person-publication-list-directive>
    </div>

    <div class="px">
        <div class="row m-b m-t">
            <div class="col-sm-12">
                <div class="input-group">
                    <span class="input-group-addon bg-primary cursor-pointer border-primary">
                        <i class="fa fa-search text-white"></i>
                    </span>
                    <input type="text" class="form-control"
                           data-ng-model="search"
                           placeholder="Haku henkilöistä"/>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 p">
                <p>Organisaation käyttäjiä yhteensä: {{persons.length}}</p>
            </div>
        </div>


        <div class="row">
            <div class="col-xs-12">
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th class="text-xl">{{i18n.admin.content.lista.tunniste[lang]}}</th>
                            <th class="text-xl">{{i18n.admin.content.lista.etunimi[lang]}}</th>
                            <th class="text-xl">{{i18n.admin.content.lista.sukunimi[lang]}}</th>
                            <th class="text-xl">{{i18n.admin.content.lista.orcid[lang]}}</th>
                            <th class="text-xl">{{i18n.admin.content.lista.muokattu[lang]}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr data-ng-repeat="person in persons | filter: search | limitTo: 20"
                        class="hover-table-green">
                        <td data-ng-click="editPerson(person)">{{person.hrnumero}}</td>
                        <td data-ng-click="editPerson(person)">{{person.etunimi}}</td>
                        <td data-ng-click="editPerson(person)">{{person.sukunimi}}</td>
                        <td data-ng-click="editPerson(person)">{{person.orcid}}</td>
                        <td data-ng-click="editPerson(person)"><span data-ng-bind="person.modified | date:'d.M.yyyy HH:mm'"></span></td>
                        <td class="text-right">
                            <span class="px">
                                <button
                                    class="btn btn-primary btn-sm"
                                    data-ng-disabled="!person.orcid"
                                    data-ng-click="showPublications(person)">Näytä julkaisut
                                </button>
                            </span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12">
            <button class="btn btn-primary btn-block btn-lg" data-ng-click="addPerson()">Lisää uusi käyttäjä
            </button>
        </div>
    </div>
    </div>
</div>